# Generic Embedding Setup - Usage Guide

## ğŸ¯ Overview

This is the **universal/generic** embedding setup that works with **any table structure**. It is completely separate from your project-specific scripts.

**Project-specific scripts (UNCHANGED):**
- `scripts/core/generate_embeddings.py` - Your original script
- `scripts/utils/text_processing.py` - Your original text processing

**New generic scripts:**
- `scripts/setup/setup_embeddings.py` - Setup wizard
- `scripts/core/generate_embeddings_universal.py` - Universal generator
- `scripts/setup/auto_detect_schema.py` - Schema detection
- `scripts/utils/text_processing_universal.py` - Generic text processing

---

## ğŸš€ Quick Start

### Step 1: Run Setup Wizard

```bash
python scripts/setup/setup_embeddings.py
```

**What it does:**
1. Asks for database connection (or uses .env)
2. Shows all tables in database
3. Lets you select a table
4. Auto-detects primary key
5. Runs intelligent field analysis
6. Suggests field weights
7. Asks for chunking parameters
8. Asks for model choice
9. Generates `config/embedding_config.json`

**Time:** ~2-5 minutes

---

### Step 2: Review Configuration (Optional)

```bash
# Edit the generated config file
nano config/embedding_config.json
```

**You can customize:**
- Field weights (3.0x, 2.0x, 1.0x)
- Field labels
- Chunk size and overlap
- Model choice
- Embeddings table name

---

### Step 3: Generate Embeddings

```bash
python scripts/core/generate_embeddings_universal.py
```

**What it does:**
1. Reads `config/embedding_config.json`
2. Connects to database
3. Creates embeddings table
4. Loads source data
5. Combines fields (based on config)
6. Chunks text
7. Generates embeddings
8. Stores in database

**Time:** ~30-60 minutes per 8K rows

---

## ğŸ“‹ Requirements

### System Requirements:
- PostgreSQL 13+ with pgvector extension
- Python 3.8+
- Required packages: `psycopg2-binary`, `sentence-transformers`, `numpy`, `tqdm`, `python-dotenv`

### Database Requirements:
- PostgreSQL database with pgvector extension
- Source table with data
- `.env` file with database credentials (or enter interactively)

---

## ğŸ”‘ Parameters

### Required (User Provides):
1. **Database Connection**
   - Host, Port, Database, User, Password
   - Source: `.env` file OR interactive prompts

2. **Source Table Name**
   - Selected from list of available tables

3. **Primary Key**
   - Auto-detected, user confirms

### Optional (Auto-Detected with Defaults):
1. **Field Weights**
   - Auto-suggested by intelligent analysis
   - User can customize

2. **Chunking Parameters**
   - Default: size=512, overlap=50
   - User can override

3. **Model Choice**
   - Default: `all-MiniLM-L6-v2` (384 dims)
   - User can choose different model

4. **Embeddings Table Name**
   - Default: `{source_table}_embeddings`
   - User can override

---

## ğŸ“ Files Created

### Configuration File:
- `config/embedding_config.json` - Generated by setup wizard
- Contains all parameters for embedding generation

### Example Config:
- `config/embedding_config.example.json` - Example structure

---

## ğŸ§ª Testing

### Test Schema Detection:
```bash
python scripts/setup/auto_detect_schema.py
```

### Test Intelligent Analysis:
```bash
python scripts/setup/intelligent_field_analysis.py
```

### Test Setup Wizard:
```bash
python scripts/setup/setup_embeddings.py
```

### Test Universal Generator:
```bash
# First create config with setup wizard, then:
python scripts/core/generate_embeddings_universal.py
```

---

## ğŸ”„ Workflow

```
1. Setup Wizard
   â†“
2. Config File Generated
   â†“
3. (Optional) Review/Edit Config
   â†“
4. Universal Generator
   â†“
5. Embeddings Table Created
   â†“
6. Ready for Search!
```

---

## âš ï¸ Important Notes

1. **Project-Specific Scripts Unchanged**
   - Your original `generate_embeddings.py` is untouched
   - Your original `text_processing.py` is untouched
   - Generic scripts are completely separate

2. **Config File Location**
   - Default: `config/embedding_config.json`
   - Can be changed in code if needed

3. **Database Password**
   - Stored as `${POSTGRES_PASSWORD}` in config
   - Reads from `.env` file at runtime
   - Never hardcoded

4. **Table Names**
   - Source table: User selects
   - Embeddings table: `{source_table}_embeddings` (default)

---

## ğŸ†˜ Troubleshooting

### Error: "Configuration file not found"
- Run setup wizard first: `python scripts/setup/setup_embeddings.py`

### Error: "Cannot connect to database"
- Check `.env` file has correct credentials
- Or enter credentials in setup wizard

### Error: "No data found in source table"
- Check table name in config
- Verify table has data

### Error: "No documents created"
- Check field weights in config
- Verify fields exist in source table
- Check field names match exactly

---

## ğŸ“Š Example Output

### Setup Wizard:
```
================================================================================
EMBEDDING SETUP WIZARD
================================================================================

âœ“ Found database configuration in .env file
Found 5 tables:
  1. requests (8,195 rows)
  2. products (1,234 rows)
  ...

Select table: 1

âœ“ Analysis complete!
Field Weight Suggestions:
  ğŸ”´ 3.0x (Critical): 12 fields
  ğŸŸ  2.0x (Important): 8 fields
  ...

âœ“ Configuration saved to: config/embedding_config.json
```

### Universal Generator:
```
================================================================================
UNIVERSAL EMBEDDING GENERATION
================================================================================

âœ“ Configuration loaded
âœ“ Database connection successful!
âœ“ Model loaded successfully!
âœ“ Loaded 8,195 rows
âœ“ Created table 'requests_embeddings'
âœ“ Created 24,585 document chunks
âœ“ Generated 24,585 embeddings
âœ“ Inserted 24,585 embeddings

âœ… SUCCESS! Embedding generation complete!
```

---

## ğŸ¯ Summary

**What's New:**
- âœ… Universal setup wizard
- âœ… Universal embedding generator
- âœ… Schema auto-detection
- âœ… Intelligent field analysis (already existed)
- âœ… Generic text processing

**What's Unchanged:**
- âœ… Your project-specific scripts
- âœ… Your existing embeddings
- âœ… Your current workflow

**Ready to Use:**
- âœ… Works with any table structure
- âœ… Fully configurable
- âœ… Tested and working

